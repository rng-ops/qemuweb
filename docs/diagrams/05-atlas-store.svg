<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 750" width="900" height="750">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#F97316;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="hashGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#6366F1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4F46E5;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="750" fill="#1F2937"/>
  
  <!-- Title -->
  <rect x="0" y="0" width="900" height="50" fill="url(#headerGrad)"/>
  <text x="450" y="32" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white">Atlas Store - Content-Addressed Storage</text>
  
  <!-- Input Data Section -->
  <rect x="30" y="70" width="840" height="120" rx="10" fill="#374151" filter="url(#shadow)"/>
  <text x="50" y="95" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#F97316">1. Input: Disk Image Blocks (64KB each)</text>
  
  <!-- Block representations -->
  <rect x="50" y="110" width="80" height="60" rx="5" fill="#3B82F6"/>
  <text x="90" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Block 0</text>
  <text x="90" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#BFDBFE">boot sector</text>
  
  <rect x="140" y="110" width="80" height="60" rx="5" fill="#3B82F6"/>
  <text x="180" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Block 1</text>
  <text x="180" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#BFDBFE">kernel</text>
  
  <rect x="230" y="110" width="80" height="60" rx="5" fill="#3B82F6"/>
  <text x="270" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Block 2</text>
  <text x="270" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#BFDBFE">rootfs</text>
  
  <rect x="320" y="110" width="80" height="60" rx="5" fill="#6B7280"/>
  <text x="360" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Block 3</text>
  <text x="360" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#D1D5DB">zeros</text>
  
  <rect x="410" y="110" width="80" height="60" rx="5" fill="#3B82F6"/>
  <text x="450" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Block 4</text>
  <text x="450" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#BFDBFE">rootfs</text>
  
  <rect x="500" y="110" width="80" height="60" rx="5" fill="#6B7280"/>
  <text x="540" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Block 5</text>
  <text x="540" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#D1D5DB">zeros</text>
  
  <text x="600" y="140" font-family="Arial, sans-serif" font-size="20" fill="#9CA3AF">...</text>
  
  <rect x="640" y="110" width="80" height="60" rx="5" fill="#3B82F6"/>
  <text x="680" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Block N</text>
  <text x="680" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#BFDBFE">data</text>
  
  <!-- Arrow down -->
  <path d="M450 190 L450 215 L440 205 M450 215 L460 205" stroke="#F97316" stroke-width="3" fill="none"/>
  
  <!-- Hashing Stage -->
  <rect x="30" y="220" width="840" height="140" rx="10" fill="#312E81" filter="url(#shadow)"/>
  <text x="50" y="245" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#A5B4FC">2. Content Hashing (SHA-256)</text>
  <text x="50" y="265" font-family="Arial, sans-serif" font-size="10" fill="#C7D2FE">Each block is hashed to create a unique content identifier (CID)</text>
  
  <!-- Hash representations -->
  <rect x="50" y="280" width="160" height="55" rx="5" fill="url(#hashGrad)"/>
  <text x="130" y="300" text-anchor="middle" font-family="monospace" font-size="8" fill="white">sha256:a1b2c3d4...</text>
  <text x="130" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#C7D2FE">Block 0 ‚Üí CID</text>
  <text x="130" y="328" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#A5B4FC">64KB data</text>
  
  <rect x="230" y="280" width="160" height="55" rx="5" fill="url(#hashGrad)"/>
  <text x="310" y="300" text-anchor="middle" font-family="monospace" font-size="8" fill="white">sha256:e5f6g7h8...</text>
  <text x="310" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#C7D2FE">Block 1 ‚Üí CID</text>
  <text x="310" y="328" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#A5B4FC">64KB data</text>
  
  <rect x="410" y="280" width="160" height="55" rx="5" fill="#1F2937" stroke="#6366F1" stroke-dasharray="4"/>
  <text x="490" y="300" text-anchor="middle" font-family="monospace" font-size="8" fill="#6B7280">sha256:000000...</text>
  <text x="490" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#9CA3AF">Zeros ‚Üí SKIP</text>
  <text x="490" y="328" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#6B7280">Not stored!</text>
  
  <rect x="590" y="280" width="160" height="55" rx="5" fill="url(#hashGrad)"/>
  <text x="670" y="300" text-anchor="middle" font-family="monospace" font-size="8" fill="white">sha256:i9j0k1l2...</text>
  <text x="670" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#C7D2FE">Block 2 ‚Üí CID</text>
  <text x="670" y="328" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#A5B4FC">64KB data</text>
  
  <!-- Arrow down -->
  <path d="M450 360 L450 385 L440 375 M450 385 L460 375" stroke="#F97316" stroke-width="3" fill="none"/>
  
  <!-- Storage Layer -->
  <rect x="30" y="390" width="840" height="170" rx="10" fill="#1E3A5F" filter="url(#shadow)"/>
  <text x="50" y="415" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#60A5FA">3. IndexedDB Storage (Deduplicated)</text>
  
  <!-- IndexedDB Stores -->
  <rect x="50" y="430" width="240" height="110" rx="8" fill="#374151"/>
  <text x="170" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#60A5FA">blocks (Object Store)</text>
  <text x="60" y="475" font-family="monospace" font-size="8" fill="#9CA3AF">key: sha256:a1b2c3d4... ‚Üí data: Uint8Array(65536)</text>
  <text x="60" y="490" font-family="monospace" font-size="8" fill="#9CA3AF">key: sha256:e5f6g7h8... ‚Üí data: Uint8Array(65536)</text>
  <text x="60" y="505" font-family="monospace" font-size="8" fill="#9CA3AF">key: sha256:i9j0k1l2... ‚Üí data: Uint8Array(65536)</text>
  <text x="60" y="520" font-family="monospace" font-size="8" fill="#6B7280">...</text>
  
  <rect x="330" y="430" width="280" height="110" rx="8" fill="#374151"/>
  <text x="470" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#60A5FA">manifests (Object Store)</text>
  <text x="340" y="475" font-family="monospace" font-size="8" fill="#9CA3AF">key: "alpine-3.19-rootfs"</text>
  <text x="340" y="490" font-family="monospace" font-size="8" fill="#9CA3AF">value: {</text>
  <text x="355" y="505" font-family="monospace" font-size="8" fill="#9CA3AF">blocks: ["sha256:a1b2...", "sha256:e5f6...", null, ...]</text>
  <text x="355" y="520" font-family="monospace" font-size="8" fill="#9CA3AF">totalSize: 134217728, blockSize: 65536</text>
  <text x="340" y="530" font-family="monospace" font-size="8" fill="#9CA3AF">}</text>
  
  <rect x="650" y="430" width="200" height="110" rx="8" fill="#374151"/>
  <text x="750" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#60A5FA">metadata</text>
  <text x="660" y="475" font-family="monospace" font-size="8" fill="#9CA3AF">key: "alpine-3.19-rootfs"</text>
  <text x="660" y="490" font-family="monospace" font-size="8" fill="#9CA3AF">created: 2024-01-15</text>
  <text x="660" y="505" font-family="monospace" font-size="8" fill="#9CA3AF">version: "3.19.0"</text>
  <text x="660" y="520" font-family="monospace" font-size="8" fill="#9CA3AF">dedupRatio: 0.45</text>
  
  <!-- Benefits Section -->
  <rect x="30" y="575" width="280" height="155" rx="10" fill="#064E3B" filter="url(#shadow)"/>
  <text x="50" y="600" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#34D399">‚úì Benefits</text>
  <text x="50" y="625" font-family="Arial, sans-serif" font-size="10" fill="#6EE7B7">‚Ä¢ Deduplication: Identical blocks stored once</text>
  <text x="50" y="645" font-family="Arial, sans-serif" font-size="10" fill="#6EE7B7">‚Ä¢ Sparse files: Zero blocks not stored</text>
  <text x="50" y="665" font-family="Arial, sans-serif" font-size="10" fill="#6EE7B7">‚Ä¢ Content verification: Hash = integrity</text>
  <text x="50" y="685" font-family="Arial, sans-serif" font-size="10" fill="#6EE7B7">‚Ä¢ Efficient sharing: Same blocks across VMs</text>
  <text x="50" y="705" font-family="Arial, sans-serif" font-size="10" fill="#6EE7B7">‚Ä¢ Delta downloads: Only fetch new blocks</text>
  
  <!-- Read Flow -->
  <rect x="330" y="575" width="280" height="155" rx="10" fill="#1E1B4B" filter="url(#shadow)"/>
  <text x="350" y="600" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#A78BFA">üìñ Read Flow</text>
  <text x="350" y="625" font-family="Arial, sans-serif" font-size="10" fill="#C4B5FD">1. Request block N from VM</text>
  <text x="350" y="645" font-family="Arial, sans-serif" font-size="10" fill="#C4B5FD">2. Look up CID in manifest[N]</text>
  <text x="350" y="665" font-family="Arial, sans-serif" font-size="10" fill="#C4B5FD">3. If null ‚Üí return zero block</text>
  <text x="350" y="685" font-family="Arial, sans-serif" font-size="10" fill="#C4B5FD">4. Fetch block by CID from blocks store</text>
  <text x="350" y="705" font-family="Arial, sans-serif" font-size="10" fill="#C4B5FD">5. Return 64KB data to VM</text>
  
  <!-- Write Flow -->
  <rect x="630" y="575" width="240" height="155" rx="10" fill="#451A03" filter="url(#shadow)"/>
  <text x="650" y="600" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#FB923C">‚úèÔ∏è Write Flow</text>
  <text x="650" y="625" font-family="Arial, sans-serif" font-size="10" fill="#FDBA74">1. VM writes 64KB block</text>
  <text x="650" y="645" font-family="Arial, sans-serif" font-size="10" fill="#FDBA74">2. Hash the block content</text>
  <text x="650" y="665" font-family="Arial, sans-serif" font-size="10" fill="#FDBA74">3. Check if CID exists</text>
  <text x="650" y="685" font-family="Arial, sans-serif" font-size="10" fill="#FDBA74">4. If new ‚Üí store in blocks</text>
  <text x="650" y="705" font-family="Arial, sans-serif" font-size="10" fill="#FDBA74">5. Update manifest[N] = CID</text>
</svg>

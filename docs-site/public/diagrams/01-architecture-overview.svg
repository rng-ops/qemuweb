<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700" width="900" height="700">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="uiGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2563EB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="workerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="storageGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="700" fill="#1F2937"/>
  
  <!-- Title -->
  <rect x="0" y="0" width="900" height="50" fill="url(#headerGrad)"/>
  <text x="450" y="32" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white">QemuWeb Architecture Overview</text>
  
  <!-- Main Thread Section -->
  <rect x="30" y="70" width="840" height="200" rx="10" fill="#374151" filter="url(#shadow)"/>
  <text x="50" y="95" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#9CA3AF">MAIN THREAD (UI)</text>
  
  <!-- React App Box -->
  <rect x="50" y="110" width="180" height="140" rx="8" fill="url(#uiGrad)"/>
  <text x="140" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">React Application</text>
  <text x="140" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#BFDBFE">• Terminal (xterm.js)</text>
  <text x="140" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#BFDBFE">• Dashboard</text>
  <text x="140" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#BFDBFE">• VM Controls</text>
  <text x="140" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#BFDBFE">• Network Topology</text>
  <text x="140" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#BFDBFE">• Agent Panel</text>
  
  <!-- QemuClient Box -->
  <rect x="260" y="110" width="180" height="140" rx="8" fill="#4B5563"/>
  <text x="350" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">QemuClient</text>
  <text x="350" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• startVm()</text>
  <text x="350" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• stopVm()</text>
  <text x="350" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• sendSerialIn()</text>
  <text x="350" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• State Management</text>
  <text x="350" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• Event Handlers</text>
  
  <!-- AI Agent Box -->
  <rect x="470" y="110" width="180" height="140" rx="8" fill="#7C3AED"/>
  <text x="560" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">AI Agent (Atlas)</text>
  <text x="560" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DDD6FE">• Ollama Integration</text>
  <text x="560" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DDD6FE">• LangChain</text>
  <text x="560" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DDD6FE">• MCP Tools</text>
  <text x="560" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DDD6FE">• Policy Engine</text>
  <text x="560" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#DDD6FE">• Vector Memory</text>
  
  <!-- Services Box -->
  <rect x="680" y="110" width="170" height="140" rx="8" fill="#6B7280"/>
  <text x="765" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Services</text>
  <text x="765" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E5E7EB">• eventTracker</text>
  <text x="765" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E5E7EB">• auditLog</text>
  <text x="765" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E5E7EB">• credentialService</text>
  <text x="765" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E5E7EB">• taskStore</text>
  <text x="765" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E5E7EB">• mcpBridge</text>
  
  <!-- Arrow from React to QemuClient -->
  <path d="M230 180 L255 180" stroke="#60A5FA" stroke-width="2" marker-end="url(#arrowBlue)"/>
  
  <!-- postMessage Arrow -->
  <path d="M350 255 L350 295" stroke="#34D399" stroke-width="3" stroke-dasharray="5,3"/>
  <text x="360" y="280" font-family="Arial, sans-serif" font-size="10" fill="#34D399">postMessage</text>
  
  <!-- Web Worker Section -->
  <rect x="30" y="300" width="840" height="160" rx="10" fill="#374151" filter="url(#shadow)"/>
  <text x="50" y="325" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#9CA3AF">WEB WORKER</text>
  
  <!-- Worker Runtime Box -->
  <rect x="50" y="340" width="250" height="100" rx="8" fill="url(#workerGrad)"/>
  <text x="175" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">QEMU Worker Runtime</text>
  <text x="175" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#A7F3D0">• Command Handler</text>
  <text x="175" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#A7F3D0">• VM Instance Manager</text>
  <text x="175" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#A7F3D0">• File Mounting (Emscripten FS)</text>
  <text x="175" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#A7F3D0">• Serial I/O Routing</text>
  
  <!-- QEMU WASM Box -->
  <rect x="330" y="340" width="250" height="100" rx="8" fill="#065F46"/>
  <text x="455" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">QEMU WebAssembly</text>
  <text x="455" y="390" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#6EE7B7">qemu-system-x86_64.wasm</text>
  <text x="455" y="410" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#6EE7B7">qemu-system-aarch64.wasm</text>
  <text x="455" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#A7F3D0">~30-50MB per arch</text>
  
  <!-- VM Config Box -->
  <rect x="610" y="340" width="240" height="100" rx="8" fill="#4B5563"/>
  <text x="730" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">VM Configuration</text>
  <text x="730" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• Profile: linux-x86_64-pc</text>
  <text x="730" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• Memory: 512 MiB</text>
  <text x="730" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• Machine: q35</text>
  <text x="730" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">• virtio-blk, virtio-net</text>
  
  <!-- Arrow from Runtime to QEMU -->
  <path d="M300 390 L325 390" stroke="#34D399" stroke-width="2"/>
  
  <!-- Storage Section -->
  <rect x="30" y="480" width="840" height="200" rx="10" fill="#374151" filter="url(#shadow)"/>
  <text x="50" y="505" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#9CA3AF">STORAGE LAYER</text>
  
  <!-- Block Device Box -->
  <rect x="50" y="520" width="200" height="140" rx="8" fill="url(#storageGrad)"/>
  <text x="150" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Block Devices</text>
  <text x="150" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FEF3C7">FileBlockDevice</text>
  <text x="150" y="590" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FEF3C7">HttpBlockDevice</text>
  <text x="150" y="610" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FEF3C7">CowBlockDevice</text>
  <text x="150" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#FDE68A">64KB block size</text>
  
  <!-- IndexedDB Box -->
  <rect x="280" y="520" width="200" height="140" rx="8" fill="#92400E"/>
  <text x="380" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">IndexedDB Overlay</text>
  <text x="380" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FDE68A">• Sparse Block Storage</text>
  <text x="380" y="590" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FDE68A">• VM Isolation</text>
  <text x="380" y="610" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FDE68A">• Export/Import</text>
  <text x="380" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#FCD34D">Persists changes</text>
  
  <!-- Atlas Store Box -->
  <rect x="510" y="520" width="200" height="140" rx="8" fill="#7C2D12"/>
  <text x="610" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Atlas Store (CAS)</text>
  <text x="610" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FECACA">• Content Hashing</text>
  <text x="610" y="590" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FECACA">• File Manifests</text>
  <text x="610" y="610" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#FECACA">• Provenance Tracking</text>
  <text x="610" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#FCA5A5">SHA-256, 4MB chunks</text>
  
  <!-- Browser APIs Box -->
  <rect x="740" y="520" width="110" height="140" rx="8" fill="#4B5563"/>
  <text x="795" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">Browser</text>
  <text x="795" y="545" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">Browser</text>
  <text x="795" y="575" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">IndexedDB</text>
  <text x="795" y="595" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">WebAssembly</text>
  <text x="795" y="615" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">Web Workers</text>
  <text x="795" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#D1D5DB">SAB*</text>
  
  <!-- Arrows in storage layer -->
  <path d="M250 590 L275 590" stroke="#FCD34D" stroke-width="2"/>
  <path d="M480 590 L505 590" stroke="#FCD34D" stroke-width="2"/>
  
  <!-- Arrow from worker to storage -->
  <path d="M175 445 L175 515" stroke="#F59E0B" stroke-width="2" stroke-dasharray="5,3"/>
  
  <!-- Legend -->
  <rect x="30" y="690" width="840" height="1" fill="#4B5563"/>
  <text x="50" y="695" font-family="Arial, sans-serif" font-size="9" fill="#6B7280">* SAB = SharedArrayBuffer (requires COOP/COEP headers)</text>
</svg>
